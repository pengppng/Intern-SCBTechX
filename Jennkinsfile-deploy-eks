pipeline {
  agent any
  environment {
    DEPLOY_PATH   = 'k8s'
  }

  stages {
    stage('Deploy to EKS') {
      steps {
        withCredentials([
          usernamePassword(credentialsId: 'aws-credentials', usernameVariable: 'AWS_ACCESS_KEY_ID', passwordVariable: 'AWS_SECRET_ACCESS_KEY')
        ]) {
          sh '''
            aws sts get-caller-identity
            echo "===> Deploying Kubernetes manifests"
            kubectl apply -f $DEPLOY_PATH/deployment.yaml
          '''
        }
      }
    }
}
}